---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { t } from '../../utils/i18n';
import MarkdownContent from '../../components/MarkdownContent.astro';
import fs from 'node:fs';
import path from 'node:path';

export async function getStaticPaths() {
  const dir = '../../../restructured_site';
  // Note: Since this runs at build time/server side in dev, we need to resolve the path
  const absoluteDir = path.resolve(process.cwd(), '../restructured_site');
  const files = fs.readdirSync(absoluteDir);
  
  return files.map(file => {
    const slug = file.replace('.md', '');
    const content = fs.readFileSync(path.join(absoluteDir, file), 'utf-8');
    
    // Detect language from filename or default to HE (since many have no suffix and are HE)
    let lang = 'he';
    if (slug.endsWith('_EN')) lang = 'en';
    if (slug.endsWith('_RU')) lang = 'ru';
    if (slug.endsWith('_HE')) lang = 'he';

    return {
      params: { slug },
      props: { content, title: slug.replace(/_/g, ' '), lang }
    };
  });
}

const { content, title, lang } = Astro.props;
---

<BaseLayout lang={lang}>
  <div class="bg-gray-50 dark:bg-[#151515] py-12 transition-colors">
    <div class="mx-auto max-w-[1200px] px-4 sm:px-6 lg:px-8">
      <div class="mb-12 flex items-center justify-between">
        <a href={lang === 'en' ? '/' : `/${lang}`} class="inline-flex items-center gap-2 text-primary font-black uppercase tracking-widest hover:underline decoration-2 underline-offset-4 group">
          <span class="material-symbols-outlined text-lg group-hover:-translate-x-1 transition-transform rtl:group-hover:translate-x-1">arrow_back</span>
          {t(lang, 'backToHome')}
        </a>
      </div>
      
      <div class="flex flex-col gap-8">
        <div class="bg-white dark:bg-background-dark p-8 md:p-12 rounded-3xl shadow-xl border border-gray-100 dark:border-white/5">
          <div class="flex flex-col gap-4 mb-12">
            <h1 class="text-4xl md:text-5xl font-black text-text-main dark:text-white uppercase tracking-tighter leading-none">
              {title}
            </h1>
            <div class="h-1.5 w-24 bg-primary"></div>
          </div>
          
          <div class="prose prose-lg dark:prose-invert max-w-none prose-headings:uppercase prose-headings:font-black prose-headings:tracking-tight prose-a:text-primary prose-a:no-underline hover:prose-a:underline">
            <MarkdownContent content={content} />
          </div>
        </div>
        
        {title.toLowerCase().includes('vision') && (
           <div class="mt-8 p-10 bg-primary/10 rounded-3xl border border-primary/20 flex flex-col items-center text-center gap-6">
             <div class="size-16 rounded-full bg-primary text-white flex items-center justify-center shadow-lg">
               <span class="material-symbols-outlined text-3xl">info</span>
             </div>
             <h2 class="text-2xl font-black text-primary uppercase">Storyblok Recommendation</h2>
             <p class="text-text-main dark:text-white max-w-xl font-medium">
               This content is part of the <strong>Mission/Vision</strong> series. We recommend using the <code>MissionSection</code> component in Storyblok to create the scrollytelling effect seen in our latest design.
             </p>
           </div>
        )}
      </div>
    </div>
  </div>
</BaseLayout>

