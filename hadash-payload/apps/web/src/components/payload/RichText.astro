
---
// Reusable RichText renderer for Lexical JSON
const { node } = Astro.props;

const serializeLexical = (node) => {
    if (!node) return '';

    if (node.type === 'text') {
        let text = node.text;
        if (node.format & 1) text = `<strong>${text}</strong>`; // bold
        if (node.format & 2) text = `<em>${text}</em>`; // italic
        if (node.format & 8) text = `<u>${text}</u>`; // underline
        return text;
    }

    if (node.type === 'paragraph') {
        return `<p class="mb-6 text-lg leading-relaxed text-gray-700 dark:text-gray-300">
            ${node.children?.map(serializeLexical).join('')}
        </p>`;
    }

    if (node.type === 'heading') {
         const Tag = node.tag || 'h2';
         const sizeClasses = {
             h1: 'text-4xl md:text-5xl font-black mb-8 mt-12 text-gray-900 dark:text-white',
             h2: 'text-3xl md:text-4xl font-bold mb-6 mt-10 text-gray-900 dark:text-white',
             h3: 'text-2xl font-bold mb-4 mt-8 text-gray-900 dark:text-white',
             h4: 'text-xl font-bold mb-4 mt-6 text-gray-900 dark:text-white',
         }
         return `<${Tag} class="${sizeClasses[Tag] || sizeClasses.h2}">${node.children?.map(serializeLexical).join('')}</${Tag}>`
    }
    
    if (node.type === 'list') {
        const Tag = node.tag === 'ol' ? 'ol' : 'ul';
        const listClasses = Tag === 'ol' ? 'list-decimal' : 'list-disc';
        return `<${Tag} class="${listClasses} pl-6 mb-6 text-lg text-gray-700 dark:text-gray-300 space-y-2">
            ${node.children?.map(serializeLexical).join('')}
        </${Tag}>`;
    }

    if (node.type === 'listitem') {
        return `<li>${node.children?.map(serializeLexical).join('')}</li>`;
    }

    // Link handling
    if (node.type === 'link') {
        const url = node.fields?.url || '#';
        return `<a href="${url}" class="text-primary hover:underline font-medium break-words">${node.children?.map(serializeLexical).join('')}</a>`;
    }
    
    // Fallback for root or other blocks
    if (node.children && Array.isArray(node.children)) {
        return node.children.map(serializeLexical).join('');
    }
    
    return '';
}

const html = serializeLexical(node);
---
<div set:html={html} />
