---
import { getPayloadPage, getPayloadPages } from '../utils/payload'
import BlockRenderer from '../components/payload/BlockRenderer.astro'
import BaseLayout from '../layouts/BaseLayout.astro'

export async function getStaticPaths() {
  const locales = ['en', 'he', 'ru']
  const paths = []

  for (const locale of locales) {
    const pages = await getPayloadPages(locale)
    for (const page of pages) {
      if (page.slug === 'index' || page.slug === 'home') continue
      
      const slug = locale === 'en' ? page.slug : `${locale}/${page.slug}`
      paths.push({
        params: { slug },
        props: { lang: locale, pageSlug: page.slug },
      })
    }
  }
  return paths
}

const { lang, pageSlug } = Astro.props
const page = await getPayloadPage(pageSlug, lang)
---

<BaseLayout lang={lang}>
  <BlockRenderer content={page?.layout} lang={lang} />
</BaseLayout>
 
